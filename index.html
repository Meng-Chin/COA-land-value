<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<title>COA TEST</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.0/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.0/mapbox-gl.css' rel='stylesheet' />
<style>
body { margin:0; padding:0; }
#map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>
 
<div id='map'></div>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoibW9ua2V5MDUwMyIsImEiOiJjajMzMnBqMGswMDJjMzNvOXd4NmtkNTR6In0.k9QqpyQkUxGk-X-OFPvMRg';
var map = new mapboxgl.Map({
container: 'map', // container id
style: 'mapbox://styles/monkey0503/ck1bvw1at01bu1dmkapz74ab2', // stylesheet location
center: [120.9, 23.9], // starting position [lng, lat]
zoom: 8 // starting zoom
});
map.on('load',
    () => {
        map.addSource("landlocation",
            {
                type: "geojson",
                data: "https://meng-chin.github.io/COA-land-value/land.geojson",
                cluster: true, // Enable clustering
                clusterRadius: 20, // Radius of each cluster when clustering points
                clusterMaxZoom: 11 // Max zoom to cluster points on
            });
        map.addLayer({
            id: 'clusters',
            type: 'circle',
            source: 'landlocation',
            paint: {
                'circle-color': {
                    property: 'point_count',
                    type: 'interval',
                    stops: [
                        [0, '#41A337'],
                        [100, '#2D7026'],
                        [750, '#0B5703'],
                    ]
                },
                'circle-radius': {
                    property: 'point_count',
                    type: 'interval',
                    stops: [
                        [0, 20],
                        [100, 30],
                        [750, 40]
                    ]
                }
            }
        });
        map.addLayer({
            id: 'cluster-count',
            type: 'symbol',
            source: 'landlocation',
            filter: ['has', 'point_count'],
            layout: {
                'text-field': '{point_count}',
                'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
                'text-size': 12
            }
        });
        map.addLayer({
            id: 'uncluster',
            type: 'circle',
            source: 'landlocation',
            filter: ['!has', 'point_count'],
            paint: {
                'circle-color': '#1EF008',
                'circle-radius': 6,
                'circle-stroke-width': 1,
                'circle-stroke-color': '#fff'
            }
        });
    });
    
map.on('click', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['unclustered-points'] });
    map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
        return;
    }

    var feature = features[0];

    // Populate the popup and set its coordinates
    // based on the feature found.
    
    
    var popup = new mapboxgl.Popup()
        .setLngLat(feature.geometry.coordinates)
        .setHTML("<b>Town;:</b> "+ feature.properties.town+  "<br />"+"<b>Address;:</b> " + feature.properties.address + "<br />" +
"<b>Area Size;:</b> " + feature.properties.land_area + "<br />" +
"<b>Type ID ;: </b> " + feature.properties.type + "<br />" +
"<b>Noncity Type ID;: </b> " + feature.properties.noncity_type + "<br />" +
"<b>Noncity;: </b> " + "<br />" + feature.properties.noncity + "<br />"+ "<b>Transfer Date;:</b>" + feature.properties.trans_date + "' target='_blank'>" + feature.properties.trans_num + "<br />" + 
"<b>Transfer Number;: </b> " + "<br />" + feature.properties.trans_num + "<br />"+"<b>Build Public;: </b> " + "<br />" + feature.properties.build_p + "<br />"+
"<b>Build Org;: </b> " + "<br />" + feature.properties.build_org + "<br />"+"<b>Total Price;: </b> " + "<br />" + feature.properties.total_price + "<br />")+
"<b>Unit Price;: </b> " + "<br />" + feature.properties.unit_price + "<br />"
        .addTo(map);
});
</script>
 
</body>
</html>
